```mermaid
graph TD
    subgraph Temporal Stream
        direction LR
        A[Input: flow (B, T, 3, H, W)] --> B(TemporalFPN)
        B --> C[Output: (B, 3, T, H, W)]
        C --> D(Reshape: (B*T, 3, H, W))
        D --> E(Conv2d) --> F(BatchNorm2d) --> G(ReLU)
        G --> H(MaxPool2d)
        H --> I(Layer1) --> J(Layer2) --> K(Layer3) --> L(Layer4)
        L --> M(AdaptiveAvgPool2d)
        M --> N(Flatten)
        N --> O(Linear)
        O --> P[Output: temporal_feat (B*T, 2048)]
    end

    subgraph Spatial Stream
        direction LR
        Q[Input: rgb (B, T, 3, 224, 224)] --> R(Reshape: (B*T, 3, 224, 224))
        R --> S(Conv2d) --> T(BatchNorm2d) --> U(ReLU) --> V(MaxPool2d)
        V --> W(Layer1) --> X(Layer2) --> Y(Layer3) --> Z(Layer4)
        Z --> AA(AdaptiveAvgPool2d)
        AA --> BB(Flatten)
        BB --> CC[Output: spatial_feat (B*T, 2048)]
        Z --> spatial_features_cam
    end

    subgraph Gated Fusion
        direction LR
        P --> DD[LayerNorm (spatial)]
        CC --> EE[LayerNorm (temporal)]
        DD --> FF(Linear) --> GG(ReLU) --> HH(Dropout) --> II[s_trans]
        EE --> JJ(Linear) --> KK(ReLU) --> LL(Dropout) --> MM[t_trans]
        II -- Concat --> NN(Linear) --> OO(ReLU) --> PP(Dropout) --> QQ(Linear) --> RR[alpha_logits]
        RR --> SS(Softmax / Temperature) --> TT[alpha]
        CC -- Mult (alpha[:, 0:1]) --> UU
        P -- Mult (alpha[:, 1:2]) --> VV
        UU + VV --> WW[fused (B*T, 2048)]
        WW --> XX[Output: fused_feat (B, T, 2048)]
        TT --> YY[Output: alpha (B*T, 2)]
    end

    subgraph Temporal Attention
        direction LR
        XX --> ZZ(TransformerEncoder) --> AAA[attended_feat (B, T, 2048)]
        AAA --> BBB(Linear) --> CCC(ReLU) --> DDD(Linear) --> EEE(Softmax) --> FFF[weights (B, T, 1)]
        AAA -- Mult --> GGG
        GGG -- Sum (dim=1) --> HHH[out (B, 2048)]
    end

    subgraph Classifier
        direction LR
        HHH --> III(Linear) --> JJJ[final_output (B, num_classes)]
    end

    Temporal Stream -- Feature --> Gated Fusion
    Spatial Stream -- Feature --> Gated Fusion
    Gated Fusion -- Fused Feature --> Temporal Attention
    Temporal Attention -- Attended Feature --> Classifier
```